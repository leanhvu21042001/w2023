<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 11: Production Preparation | MAD9124</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Full-stack: API Development">
    
    <link rel="preload" href="/w2023/assets/css/0.styles.494dd125.css" as="style"><link rel="preload" href="/w2023/assets/js/app.60650c02.js" as="script"><link rel="preload" href="/w2023/assets/js/3.4b0adc00.js" as="script"><link rel="preload" href="/w2023/assets/js/31.0af45ea5.js" as="script"><link rel="preload" href="/w2023/assets/js/15.c072e039.js" as="script"><link rel="preload" href="/w2023/assets/js/16.98a772dc.js" as="script"><link rel="prefetch" href="/w2023/assets/js/10.f600ef9c.js"><link rel="prefetch" href="/w2023/assets/js/11.59cce816.js"><link rel="prefetch" href="/w2023/assets/js/12.9a8f0e36.js"><link rel="prefetch" href="/w2023/assets/js/13.b4c9d204.js"><link rel="prefetch" href="/w2023/assets/js/14.1bbcf46f.js"><link rel="prefetch" href="/w2023/assets/js/17.2696ccfd.js"><link rel="prefetch" href="/w2023/assets/js/18.4c772c8d.js"><link rel="prefetch" href="/w2023/assets/js/19.0ed82ce5.js"><link rel="prefetch" href="/w2023/assets/js/2.5288beb2.js"><link rel="prefetch" href="/w2023/assets/js/20.770d7140.js"><link rel="prefetch" href="/w2023/assets/js/21.6ef972b3.js"><link rel="prefetch" href="/w2023/assets/js/22.ef81ef04.js"><link rel="prefetch" href="/w2023/assets/js/23.417c179f.js"><link rel="prefetch" href="/w2023/assets/js/24.bdbbc474.js"><link rel="prefetch" href="/w2023/assets/js/25.036dac97.js"><link rel="prefetch" href="/w2023/assets/js/26.cfed9991.js"><link rel="prefetch" href="/w2023/assets/js/27.f330a31c.js"><link rel="prefetch" href="/w2023/assets/js/28.49afbf1d.js"><link rel="prefetch" href="/w2023/assets/js/29.37e36a86.js"><link rel="prefetch" href="/w2023/assets/js/30.32dcbee6.js"><link rel="prefetch" href="/w2023/assets/js/32.7ce3bc44.js"><link rel="prefetch" href="/w2023/assets/js/33.589d5da0.js"><link rel="prefetch" href="/w2023/assets/js/34.fd5d60cc.js"><link rel="prefetch" href="/w2023/assets/js/35.eb1cbce0.js"><link rel="prefetch" href="/w2023/assets/js/36.2c862154.js"><link rel="prefetch" href="/w2023/assets/js/37.5398f93e.js"><link rel="prefetch" href="/w2023/assets/js/38.cf75b57c.js"><link rel="prefetch" href="/w2023/assets/js/39.9092bb5a.js"><link rel="prefetch" href="/w2023/assets/js/4.a4d15534.js"><link rel="prefetch" href="/w2023/assets/js/5.9ee2e4c7.js"><link rel="prefetch" href="/w2023/assets/js/6.62eb8be9.js"><link rel="prefetch" href="/w2023/assets/js/7.109c5752.js"><link rel="prefetch" href="/w2023/assets/js/8.8ff7fd07.js"><link rel="prefetch" href="/w2023/assets/js/9.42e2f10f.js">
    <link rel="stylesheet" href="/w2023/assets/css/0.styles.494dd125.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2023/" class="home-link router-link-active"><!----> <span class="site-name">MAD9124</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/w2023/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/w2023/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2023/modules/" aria-current="page" class="sidebar-link">Table of contents</a></li><li><a href="/w2023/modules/week1/" class="sidebar-link">Week 1: Introduction &amp; Review</a></li><li><a href="/w2023/modules/week2/" class="sidebar-link">Week 2: Node Modules &amp; Express</a></li><li><a href="/w2023/modules/week3/" class="sidebar-link">Week 3: RESTful APIs</a></li><li><a href="/w2023/modules/week4/" class="sidebar-link">Week 4: Middleware functions</a></li><li><a href="/w2023/modules/week5/" class="sidebar-link">Week 5: Data persistance</a></li><li><a href="/w2023/modules/week6/" class="sidebar-link">Week 6: Object Data Modeling</a></li><li><a href="/w2023/modules/week7/" class="sidebar-link">Week 7: Data security</a></li><li><a href="/w2023/modules/break-week/" class="sidebar-link">Break Week</a></li><li><a href="/w2023/modules/week8/" class="sidebar-link">Week 8: Access Control with JWT</a></li><li><a href="/w2023/modules/week9/" class="sidebar-link">Week 9: JWT Review</a></li><li><a href="/w2023/modules/week10/" class="sidebar-link">Week 10: Consistent Error Handling</a></li><li><a href="/w2023/modules/week11/" aria-current="page" class="active sidebar-link">Week 11: Production Preparation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#agenda" class="sidebar-link">Agenda</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#ama-review" class="sidebar-link">AMA / Review</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#validate-id" class="sidebar-link">Validate ID</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#logging" class="sidebar-link">Logging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#winston" class="sidebar-link">Winston</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#node-env" class="sidebar-link">NODE_ENV</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#configuration-settings" class="sidebar-link">Configuration Settings</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#environment-variables" class="sidebar-link">Environment Variables</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#generate-jwt-secret" class="sidebar-link">Generate JWT Secret</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#compression" class="sidebar-link">Compression</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#security-middleware" class="sidebar-link">Security Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#cors" class="sidebar-link">CORS</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#helmet" class="sidebar-link">Helmet</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#npm-audit" class="sidebar-link">NPM audit</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week11/#for-next-week" class="sidebar-link">For next week</a></li></ul></li><li><a href="/w2023/modules/week12/" class="sidebar-link">Week 12: Testing</a></li><li><a href="/w2023/modules/week13/" class="sidebar-link">Week 13: Production Deployment</a></li><li><a href="/w2023/modules/week14/" class="sidebar-link">Week 14: Final Lab</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1><span class="week">Week 11</span><br> <span class="title">Production Preparation</span></h1> <div class="custom-block danger"><p class="custom-block-title">Quiz 8: Error Handling <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>15 mins</span></p> <p>There will be a quiz today. It will be worth 2% of your final grade.</p></div> <p>As you work on completing the final project, it is time to look at some techniques to better manage environment specific application configuration and security settings.</p> <h2 id="agenda"><a href="#agenda" class="header-anchor">#</a> Agenda</h2> <ul><li>AMA (10 mins)</li> <li>Quiz (10 mins)</li> <li>Logging (20 mins)</li> <li>Configuration Settings (20 mins)</li> <li>Compression (2 mins)</li> <li>Security Middleware (6 mins)</li> <li>NPM Audit (2 mins)</li> <li>Lab Time</li></ul> <h2 id="ama-review"><a href="#ama-review" class="header-anchor">#</a> AMA / Review</h2> <h3 id="validate-id"><a href="#validate-id" class="header-anchor">#</a> Validate ID</h3> <p>Our earlier solution (from week 8) to checking for a valid ID was incomplete and will produce two different error messages. I was hoping that you would discover this through your testing for the A3 assignment, and some of you did.</p> <p>If the <code>_id</code> value is correctly formatted but does not exist in the database we will get the desired <code>ResourceNotFound</code> error.</p> <p>However, if in your testing you used a simple integer value like <code>5</code> for the ID, Mongoose will respond with a type cast error instead. It would be preferable to return the same <code>ResourceNotFound</code> error in either case.</p> <p>To check if the user supplied <code>id</code> is in the correct ObjectId format, we use <code>mongoose.Types.ObjectId.isValid(id)</code>. I use a small helper function for this ...</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Helper functions</span>
<span class="token keyword">const</span> <span class="token function-variable function">validateId</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mongoose<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> Student<span class="token punctuation">.</span><span class="token function">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ResourceNotFound</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Could not find a Student with id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>... and then in the route handler simply call <code>await validateId(req.params.id)</code>.</p> <h2 id="logging"><a href="#logging" class="header-anchor">#</a> Logging</h2> <p>In production applications, it is a good practice to use a logger like <a href="https://www.npmjs.com/package/winston" target="_blank" rel="noopener noreferrer">Winston<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> instead of writing debug or console.log statements. Instead of just writing debug statements to the console, a logger can also write them out to a file or database table that can be analysed later.</p> <p>A logger lets you tag your output with a <a href="https://www.npmjs.com/package/winston#logging-levels" target="_blank" rel="noopener noreferrer">severity level<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This makes it easier to filter for right level of detail.</p> <h3 id="winston"><a href="#winston" class="header-anchor">#</a> Winston</h3> <p>Let's install and setup Winston.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> winston
</code></pre></div><p>Now define a new <code>logger.js</code> module in the <code>/startup</code> folder.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> winston <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'winston'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> logger <span class="token operator">=</span> winston<span class="token punctuation">.</span><span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">format</span><span class="token operator">:</span> winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">defaultMeta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">service</span><span class="token operator">:</span> <span class="token string">'user-service'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">transports</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">//</span>
    <span class="token comment">// - Write to all logs with level `info` and below to `combined.log`</span>
    <span class="token comment">// - Write all logs error (and below) to `error.log`.</span>
    <span class="token comment">//</span>
    <span class="token keyword">new</span> <span class="token class-name">winston<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>File</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'error.log'</span><span class="token punctuation">,</span> <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">winston<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>File</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'combined.log'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//</span>
<span class="token comment">// If we're not in production then log to the `console` with the format:</span>
<span class="token comment">// `${info.level}: ${info.message} JSON.stringify({ ...rest }) `</span>
<span class="token comment">//</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">winston<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>Console</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">simple</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> logger
</code></pre></div><p>Import this <code>logger</code> module in every other module and update any console.log or debug statements. For example in the <code>/startup/connectDatabase</code> module ...</p> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./logger'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
  mongoose
    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mongodb://localhost:27017/mad9124</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useCreateIndex</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useFindAndModify</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Connected to MongoDB ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error connecting to MongoDB ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Winston is a very flexible logger with a lot of additional capabilities. Be sure to <a href="https://www.npmjs.com/package/winston" target="_blank" rel="noopener noreferrer">read the full documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to know what it can do.</p> <h3 id="node-env"><a href="#node-env" class="header-anchor">#</a> NODE_ENV</h3> <p>Like in the Winston configuration above, it is very common to have conditional logic in the main app startup module(s) that set different behaviours based on the deployment environment. For example, we generally want to see debugging or detailed logging during development, but want to suppress these in production.</p> <p>As you know we can access command shell environment variables using the <code>process.env</code> object. It is a common best practice to set the <code>NODE_ENV</code> environment variable to indicate the current runtime environment. Some typical values are: <code>dev</code>, <code>development</code>, <code>test</code>, <code>staging</code>, <code>prod</code>, <code>production</code>.</p> <p>If <code>NODE_ENV</code> is not set, <code>process.env.NODE_ENV</code> returns <code>undefined</code>.</p> <p>Because this is such a common use case, Express provides another way to read the <code>NODE_ENV</code> environment variable – using <code>app.get('env')</code>. If <code>NODE_ENV</code> is not set, <code>app.get('env')</code> returns <code>development</code> as a default value.</p> <p>To declare the production environment run this command in the terminal.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>production
</code></pre></div><p>To set it back to development simply reset the value of the <code>NODE_ENV</code> variable.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>development
</code></pre></div><h2 id="configuration-settings"><a href="#configuration-settings" class="header-anchor">#</a> Configuration Settings</h2> <p>There are many configuration parameters for an application, such as database connection details, encryption keys, third party API access keys, etc. Some or all of these details may change from one environment to the next.</p> <p>To make our code less brittle, we centralize most these parameters in some JSON files while others should not be stored in source control and are supplied through environment variables.</p> <p>To simplify accessing these configuration parameters throughout our application code, we can use an NPM package simply called <a href="https://www.npmjs.com/package/config" target="_blank" rel="noopener noreferrer">config<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> config
<span class="token function">mkdir</span> config
<span class="token function">touch</span> config/default.json
</code></pre></div><p>Edit the <em>/config/default.json</em> file to add any parameters that we want to be able to access elsewhere in our code.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My Application&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;db&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token string">&quot;27017&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mad9124-mckennr&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jwt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;saltRounds&quot;</span><span class="token operator">:</span> <span class="token number">14</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can access these parameters in other code modules by requiring the <code>config</code> module and then using it's <code>config.get()</code> method. For example we could re-write the <code>/startup/databaseConnect</code> module like this.</p> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'config'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./logger'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> dbConfig <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'db'</span><span class="token punctuation">)</span>
  mongoose
    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mongodb://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dbConfig<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dbConfig<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dbConfig<span class="token punctuation">.</span>dbName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useCreateIndex</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useFindAndModify</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Connected to MongoDB ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error connecting to MongoDB ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can additional files named to match the <code>NODE_ENV</code> setting. For example to override the hostname of the database server in production, we can create a <code>production.json</code> file in the <code>/config</code> folder.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;db&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;db.myapp.io&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The config module will merge the properties in <code>default.json</code> with those of the current environment as set in <code>NODE_ENV</code>.</p> <h3 id="environment-variables"><a href="#environment-variables" class="header-anchor">#</a> Environment Variables</h3> <blockquote><p>Some deployment situations rely heavily on environment variables to configure secrets and settings best left out of a codebase.</p></blockquote> <p>We can map environment variables to the config settings object. Create a new file called <code>custom-environment-variables.json</code> in the <code>config</code> folder.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Then name of this file, MUST be <code>custom-environment-variables.json</code>. Any typos will prevent it from being correctly recognized.</p></div> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;db&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;userName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;APP_DBUSER&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;APP_DBPASSWORD&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jwt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;secretKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;APP_JWTKEY&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the terminal, set the values for these environment variables.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">APP_DBUSER</span><span class="token operator">=</span>datagod
<span class="token builtin class-name">export</span> <span class="token assign-left variable">APP_DBPASSWORD</span><span class="token operator">=</span>supersecret
<span class="token builtin class-name">export</span> <span class="token assign-left variable">APP_JWTKEY</span><span class="token operator">=</span>myOtherSuperSecretKey
</code></pre></div><p>Then in our code we can access these properties from the config object as normal.</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// will print datagod</span>
</code></pre></div><h3 id="generate-jwt-secret"><a href="#generate-jwt-secret" class="header-anchor">#</a> Generate JWT Secret</h3> <p>The JWT secret key can be any string value. To make it more effective, it should be at least 30 characters and preferably random. Here is a simple script to generate a new random key. Create a new top level file called <code>genKey.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">36</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>When you are setting up your deployment environment, run the script and then copy the output to set the environment variable.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">node</span> genKey.js
ixzz7ph7goovu62b6hz3k6egyghhbn

<span class="token builtin class-name">export</span> <span class="token assign-left variable">APP_JWTKEY</span><span class="token operator">=</span>ixzz7ph7goovu62b6hz3k6egyghhbn
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">DANGER</p> <p>The JWT secret key should only be changed if there is a suspected security breach. Changing it will immediately invalidate all exiting tokens.</p></div> <h2 id="compression"><a href="#compression" class="header-anchor">#</a> Compression</h2> <p>To improve network communications performance, we look for any opportunity to reduce the payload size for any given request/response cycle. One such possibility is to use standard text compression algorithms on the response payload.</p> <p>The NPM module called <a href="https://github.com/expressjs/compression" target="_blank" rel="noopener noreferrer">compression<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a Node.js compression middleware. It will attempt to compress the <code>response.body</code> using gzip for responses with a compatible <code>Content-Type</code> header value (e.g. text/html or application/json). See the <a href="https://www.npmjs.com/package/compressible" target="_blank" rel="noopener noreferrer">compressible<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> module for default behaviour.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> compression
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> compression <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// attempt to compress all routes</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">compression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="security-middleware"><a href="#security-middleware" class="header-anchor">#</a> Security Middleware</h2> <p>As we have discussed before, good application security is not &quot;a feature&quot; and not &quot;a bolt-on module&quot;. It is about applying multi-layered best practices throughout the design and development cycle. As we prepare to deploy our web service to a production environment, <a href="https://www.npmjs.com/package/cors" target="_blank" rel="noopener noreferrer">CORS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://www.npmjs.com/package/helmet" target="_blank" rel="noopener noreferrer">Helmet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are two important middleware modules that help.</p> <h3 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h3> <p>Read this <em>HTML5 Rocks</em> backgrounder on <a href="https://www.html5rocks.com/en/tutorials/cors/" target="_blank" rel="noopener noreferrer">Cross-Origin Resource Sharing (CORS)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <blockquote><p>The use-case for CORS is simple. Imagine the site alice.com has some data that the site bob.com wants to access. This type of request traditionally wouldn’t be allowed under the browser’s same origin policy. However, by supporting CORS requests, alice.com can add a few special response headers that allows bob.com to access the data.</p></blockquote> <p>To manage CORS in our Express web service use the <a href="https://www.npmjs.com/package/cors" target="_blank" rel="noopener noreferrer">cors<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> package from NPM.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> cors
</code></pre></div><p>Then require it in the main <code>app.js</code> module and apply it as the first middleware with the default settings.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// other middleware goes here</span>
</code></pre></div><p>The <code>cors()</code> middleware constructor function takes an optional <a href="https://www.npmjs.com/package/cors#configuration-options" target="_blank" rel="noopener noreferrer">configuration options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> object. The default settings are equivalent to setting the options object with these values.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;methods&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GET,HEAD,PUT,PATCH,POST,DELETE&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;preflightContinue&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;optionsSuccessStatus&quot;</span><span class="token operator">:</span> <span class="token number">204</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This will let a client app served from <em>any</em> domain name access the API resources.</p> <h3 id="helmet"><a href="#helmet" class="header-anchor">#</a> Helmet</h3> <p>The <a href="https://www.npmjs.com/package/helmet" target="_blank" rel="noopener noreferrer">helmet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> NPM module is an integrated middleware package (with 14 sub-modules) that implements many network communications <strong>security best practices</strong>.</p> <blockquote><p>It's not a silver bullet, but it can help!</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> helmet
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> helmet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'helmet'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">helmet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Not all of the included middleware functions are enabled by default. See the <a href="https://helmetjs.github.io/docs/" target="_blank" rel="noopener noreferrer">full documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for all of the options and details about the kinds of attacks they help to prevent.</p> <h2 id="npm-audit"><a href="#npm-audit" class="header-anchor">#</a> NPM audit</h2> <p>The NPM package manager has a built-in function to scan the entire dependency tree for known security vulnerabilities. This will output a list of packages that may need to be updated or replaced with a more secure library module. It is a good idea to run this check regularly, as new attack vectors are discovered and reported on an ongoing basis.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> audit
</code></pre></div><h2 id="for-next-week"><a href="#for-next-week" class="header-anchor">#</a> For next week</h2> <p>Before next week's class, please read these additional online resources.</p> <p><a href="https://martinfowler.com/articles/serverless.html" target="_blank" rel="noopener noreferrer">Martin Fowler's Serverless Architectures<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block warning"><p class="custom-block-title">Quiz</p> <p>There will be a short quiz next class. The questions could come from any of the material referenced above.</p></div> <div class="custom-block warning"><p class="custom-block-title">Assignment Reminder</p> <p><a href="/w2023/deliverables/final.html">Final project - GIFTR</a> is due by <strong>5:00 pm April 17, 2020</strong>.<br>
This is the final deadline. There will be no extensions.</p> <p>Counts for 30% of your MAD9124 final grade.</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/29/2020, 6:25:27 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2023/modules/week10/" class="prev">
        Week 10: Consistent Error Handling
      </a></span> <span class="next"><a href="/w2023/modules/week12/">
        Week 12: Testing
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/w2023/assets/js/app.60650c02.js" defer></script><script src="/w2023/assets/js/3.4b0adc00.js" defer></script><script src="/w2023/assets/js/31.0af45ea5.js" defer></script><script src="/w2023/assets/js/15.c072e039.js" defer></script><script src="/w2023/assets/js/16.98a772dc.js" defer></script>
  </body>
</html>
